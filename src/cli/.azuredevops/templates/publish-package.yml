parameters:
- name: pathToSrc
  type: string
  default: '$(Build.SourcesDirectory)/src'
- name: dryRun
  type: boolean
  default: true

steps:
- task: FlutterCommand@0
  displayName: 'Flutter Pub Publish Dry Run'
  condition: ${{ parameters.dryRun }}
  inputs:
    projectDirectory: '${{ parameters.pathToSrc }}/cli'
    arguments: 'pub publish --dry-run'

- script: | 
    gcloud auth activate-service-account --key-file=$(DownloadGCloudKey.secureFilePath)
    gcloud auth print-identity-token --audiences=https://pub.dev | dart pub token add https://pub.dev
    dart pub publish --force
  condition: eq(${{ parameters.dryRun }}, false)
  displayName: 'Flutter Pub Publish'